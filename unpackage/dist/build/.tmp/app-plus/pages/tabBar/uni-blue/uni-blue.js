(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabBar/uni-blue/uni-blue"],{"0fa2":function(e,t,i){"use strict";i.r(t);var n=i("3b9f"),a=i.n(n);for(var c in n)"default"!==c&&function(e){i.d(t,e,function(){return n[e]})}(c);t["default"]=a.a},2249:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},a=[];i.d(t,"a",function(){return n}),i.d(t,"b",function(){return a})},"3b9f":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{bds:[],bdsList:[],deviceId:null,deivceValue:"",bconnect:!1,bss:[],bssList:[],serviceId:null,serviceValue:"",bscs:[],characteristicId:null,characteristicValue:"",bscws:[],wcharacteristicId:null,wcharacteristicValue:"",writevalue:"test",state:{available:!1,discovering:!1}}},methods:{openBluetoothAdapter:function(){e.openBluetoothAdapter({success:function(e){console.log(e," at pages\\tabBar\\uni-blue\\uni-blue.vue:71"),that.onBluetoothAdapterStateChange(),that.startBluetoothDevicesDiscovery(),that.onBluetoothDeviceFound(),that.onBLEConnectionStateChange(),that.onBLECharacteristicValueChange()}})},startBluetoothDevicesDiscovery:function(){var t=this;t.resetDevices(),e.startBluetoothDevicesDiscovery({success:function(e){}})},stopBluetoothDevicesDiscovery:function(){e.stopBluetoothDevicesDiscovery({success:function(e){console.log(e," at pages\\tabBar\\uni-blue\\uni-blue.vue:96")}})},onBluetoothDeviceFound:function(){var t=this;e.onBluetoothDeviceFound(function(e){console.log("new device list has founded"," at pages\\tabBar\\uni-blue\\uni-blue.vue:104"),console.dir(e),console.log(t.ab2hex(e[0].advertisData)," at pages\\tabBar\\uni-blue\\uni-blue.vue:106");var i=e,n=[];if(i.map(function(e){e.deviceId&&n.push(e)}),t.bds=n,!t.bconnect&&n.length>0){var a=n[n.length-1].name;(!a||a.length<=0)&&(a=n[n.length-1].deviceId),t.deivceValue=a,t.deviceId=n[n.length-1].deviceId}t.getBluetoothDevices()})},getBluetoothDevices:function(){var t=this;e.getBluetoothDevices({success:function(e){console.log(e," at pages\\tabBar\\uni-blue\\uni-blue.vue:133"),e.devices[0]&&console.log(t.ab2hex(e.devices[0].advertisData)," at pages\\tabBar\\uni-blue\\uni-blue.vue:135"),t.getConnectedBluetoothDevices(),t.stopBluetoothDevicesDiscovery()}})},getConnectedBluetoothDevices:function(){e.getConnectedBluetoothDevices({success:function(e){console.log(e," at pages\\tabBar\\uni-blue\\uni-blue.vue:147")}})},getBluetoothAdapterState:function(){e.getBluetoothAdapterState({success:function(e){console.log(e," at pages\\tabBar\\uni-blue\\uni-blue.vue:155")}})},onBluetoothAdapterStateChange:function(){var t=this;e.onBluetoothAdapterStateChange(function(e){console.log("adapterState changed, now is",e," at pages\\tabBar\\uni-blue\\uni-blue.vue:163"),t.state=e})},onBLEConnectionStateChange:function(){var t=this;e.onBLEConnectionStateChange(function(e){console.log("device ".concat(e.deviceId," state has changed, connected: ").concat(e.connected)," at pages\\tabBar\\uni-blue\\uni-blue.vue:172"),t.deviceId==e.deviceId&&(t.bconnect=e.connected)})},onBLECharacteristicValueChange:function(){var t=this;e.onBLECharacteristicValueChange(function(i){console.log("characteristic ".concat(i.characteristicId," has changed, now is ").concat(i.value)," at pages\\tabBar\\uni-blue\\uni-blue.vue:181"),console.log(t.ab2hex(i.value)," at pages\\tabBar\\uni-blue\\uni-blue.vue:182");var n=t.ab2hex(i.value);t.characteristicId==i.characteristicId?t.readvalueValue=n:t.wcharacteristicId==i.characteristicId&&e.showToast({title:n,icon:"none"})})},openDevice:function(){var t=this,i=t.bds;if(i.length<=0)e.showToast({title:"未搜索到有效蓝牙设备",icon:"none"});else{var n=[];i.map(function(e){var t=e.name;(!t||t.length<=0)&&(t=e.deviceId),n.push({title:t})}),t.bdsList=n}},selectDevice:function(){var t=this,i=t.bds;if(i.length<=0)e.showToast({title:"未搜索到有效蓝牙设备",icon:"none"});else{var n=[];for(var a in i){var c=i[a].name;(!c||c.length<=0)&&(c=i[a].deviceId),n.push({title:c})}plus.nativeUI.actionSheet({title:"选择蓝牙设备",cancel:"取消",buttons:n},function(e){e.index>0&&(t.deivceValue=i[e.index-1].name,t.deviceId=i[e.index-1].deviceId)})}},connectDevice:function(){var t=this,i=t.deviceId;i?e.createBLEConnection({deviceId:i,success:function(t){e.showToast({title:"连接成功",icon:"none"}),console.log("连接成功"," at pages\\tabBar\\uni-blue\\uni-blue.vue:252"),console.log(t," at pages\\tabBar\\uni-blue\\uni-blue.vue:253")}}):e.showToast({title:"未选择设备",icon:"none"})},getServices:function(){var t=this,i=t.deviceId,n=t.bconnect;i?n?(t.resetDevices(!0),console.log("获取蓝牙设备服务"," at pages\\tabBar\\uni-blue\\uni-blue.vue:271"),e.getBLEDeviceServices({deviceId:i,success:function(e){console.log("device services:",e.services," at pages\\tabBar\\uni-blue\\uni-blue.vue:277"),console.log("获取服务成功! "+i.length," at pages\\tabBar\\uni-blue\\uni-blue.vue:278");var i=e.services,n=[];if(i.length>0){for(var a in i)n.push(i[a]);t.bss=n,n.length>0&&(t.serviceValue=t.serviceId=n[n.length-1].uuid)}else console.log("获取服务列表为空?"," at pages\\tabBar\\uni-blue\\uni-blue.vue:290")},fail:function(e){console.log("获取服务失败! "+JSON.stringify(e)," at pages\\tabBar\\uni-blue\\uni-blue.vue:294")}})):e.showToast({title:"未连接蓝牙设备",icon:"none"}):e.showToast({title:"未选择设备",icon:"none"})},openService:function(){var t=this,i=t.bss;if(i.length<=0)e.showToast({title:"未获取到有效蓝牙服务",icon:"none"});else{var n=[];for(var a in i)n.push({title:i[a].uuid});t.bssList=n}},selectService:function(){var t=this,i=t.bss;if(i.length<=0)e.showToast({title:"未获取到有效蓝牙服务",icon:"none"});else{var n=[];for(var a in i)n.push({title:i[a].uuid});plus.nativeUI.actionSheet({title:"选择服务",cancel:"取消",buttons:n},function(e){e.index>0&&(t.serviceValue=t.serviceId=i[e.index-1].uuid)})}},getCharacteristics:function(){var t=this,i=t.deviceId,n=t.bconnect,a=t.serviceId;i?n?a?(t.resetDevices(!0,!0),console.log("获取蓝牙设备某个服务中所有特征值(characteristic):"," at pages\\tabBar\\uni-blue\\uni-blue.vue:357"),e.getBLEDeviceCharacteristics({deviceId:i,serviceId:a,success:function(n){console.log("device getBLEDeviceCharacteristics:",n.characteristics," at pages\\tabBar\\uni-blue\\uni-blue.vue:362");var c=n.characteristics;if(c.length>0){for(var s in c){var o=c[s];if(console.log(JSON.stringify(o)," at pages\\tabBar\\uni-blue\\uni-blue.vue:367"),o.properties&&(o.properties.read&&t.bscs.push(c[s]),o.properties.write&&(t.bscws.push(c[s]),o.properties.notify||o.properties.indicate))){var u=o.uuid;e.notifyBLECharacteristicValueChange({state:!0,deviceId:i,serviceId:a,characteristicId:u,success:function(e){console.log("notifyBLECharacteristicValueChange "+o.uuid+" success."," at pages\\tabBar\\uni-blue\\uni-blue.vue:382")},fail:function(e){console.log("notifyBLECharacteristicValueChange "+o.uuid+" failed! "+JSON.stringify(e)," at pages\\tabBar\\uni-blue\\uni-blue.vue:385")}})}}var l=t.bscs;l.length>0&&(t.characteristicValue=t.characteristicId=l[l.length-1].uuid);var r=t.bscws;r.length>0&&(t.wcharacteristicValue=t.wcharacteristicId=r[r.length-1].uuid)}else console.log("获取特征值列表为空?"," at pages\\tabBar\\uni-blue\\uni-blue.vue:401")}})):e.showToast({title:"未选择服务",icon:"none"}):e.showToast({title:"未连接蓝牙设备",icon:"none"}):e.showToast({title:"未选择设备",icon:"none"})},selectCharacteristic:function(){var t=this,i=t.bscs;if(i.length<=0)e.showToast({title:"未获取到有效可读特征值",icon:"none"});else{var n=[];for(var a in i)n.push({title:i[a].uuid});plus.nativeUI.actionSheet({title:"选择特征值",cancel:"取消",buttons:n},function(e){e.index>0&&(t.characteristicValue=t.characteristicId=i[e.index-1].uuid)})}},readValue:function(){var t=this,i=t.deviceId,n=t.bconnect,a=t.serviceId,c=t.characteristicId;i?n?a?c?e.readBLECharacteristicValue({deviceId:i,serviceId:a,characteristicId:c,success:function(e){console.log("readBLECharacteristicValue:",e.errCode," at pages\\tabBar\\uni-blue\\uni-blue.vue:458")}}):e.showToast({title:"未选择读取的特征值",icon:"none"}):e.showToast({title:"未选择服务",icon:"none"}):e.showToast({title:"未连接蓝牙设备",icon:"none"}):e.showToast({title:"未选择设备",icon:"none"})},selectwCharacteristic:function(){var t=this,i=t.bscws;if(i.length<=0)e.showToast({title:"未获取到有效可写特征值",icon:"none"});else{var n=[];for(var a in i)n.push({title:i[a].uuid});plus.nativeUI.actionSheet({title:"选择特征值",cancel:"取消",buttons:n},function(e){e.index>0&&(t.wcharacteristicValue=t.wcharacteristicId=i[e.index-1].uuid)})}},writeValue:function(){var t=this,i=t.deviceId,n=t.bconnect,a=t.serviceId,c=t.wcharacteristicId,s=t.writevalue;if(i)if(n)if(a)if(c){var o=s;o&&""!=o?t.str2ArrayBuffer(o,function(t){console.log("写入蓝牙设备的特征值数据: "," at pages\\tabBar\\uni-blue\\uni-blue.vue:517");var n=c;e.writeBLECharacteristicValue({deviceId:i,serviceId:a,characteristicId:n,value:t,success:function(e){console.log("写入数据成功!"," at pages\\tabBar\\uni-blue\\uni-blue.vue:525"),console.log("writeBLECharacteristicValue success",e.errMsg," at pages\\tabBar\\uni-blue\\uni-blue.vue:526")}})}):e.showToast({title:"请输入需要写入的数据",icon:"none"})}else e.showToast({title:"未选择写入的特征值",icon:"none"});else e.showToast({title:"未选择服务",icon:"none"});else e.showToast({title:"未连接蓝牙设备",icon:"none"});else e.showToast({title:"未选择设备",icon:"none"})},str2ArrayBuffer:function(e,t){var i=new ArrayBuffer(2),n=new Uint8Array(i);n[0]=98,n[1]=17,t&&t.call(null,i)},resetDevices:function(e,t){var i=this;e||(i.bds=[],i.bdsList=[],i.deviceId=null,i.deivceValue=""),t||(i.bss=[],i.bssList=[],i.serviceId=null,i.serviceValue=""),i.bscs=[],i.bscws=[],i.characteristicId=null,i.wcharacteristicId=null,i.characteristicValue="",i.wcharacteristicValue=""},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),function(e){return("00"+e.toString(16)).slice(-2)});return t.join("")},closeBLEConnection:function(){var t=this,i=t.deviceId;i?(t.resetDevices(!0),console.log("断开蓝牙设备连接："," at pages\\tabBar\\uni-blue\\uni-blue.vue:582"),e.closeBLEConnection({deviceId:i,success:function(e){console.log("断开连接成功"," at pages\\tabBar\\uni-blue\\uni-blue.vue:586")}})):e.showToast({title:"未选择设备",icon:"none"})},closeBluetoothAdapter:function(){outSet("关闭蓝牙适配器："),that.resetDevices(),e.closeBluetoothAdapter({success:function(e){console.log("关闭成功"," at pages\\tabBar\\uni-blue\\uni-blue.vue:596")}})}}};t.default=i}).call(this,i("6e42")["default"])},"4f47":function(e,t,i){"use strict";i.r(t);var n=i("2249"),a=i("0fa2");for(var c in a)"default"!==c&&function(e){i.d(t,e,function(){return a[e]})}(c);var s=i("2877"),o=Object(s["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=o.exports}},[["b1da","common/runtime","common/vendor"]]]);